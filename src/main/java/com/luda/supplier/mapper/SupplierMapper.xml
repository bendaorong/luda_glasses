<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.luda.supplier.dao.SupplierDao" >
    <resultMap id="supplierMapper" type="com.luda.supplier.model.SupplierModel">
        <id property="supplierId" column="supplier_id" />
        <result property="supplierCode" column="supplier_code"/>
        <result property="supplierName" column="supplier_name"/>
        <result property="bank" column="bank"/>
        <result property="bankAccount" column="bank_account"/>
        <result property="regTaxNo" column="reg_tax_no"/>
        <result property="contactPerson" column="contact_person"/>
        <result property="contactPhone" column="contact_phone"/>
        <result property="useFlag" column="use_flag"/>
        <result property="remark" column="remark"/>
    </resultMap>

    <select id="fetchSupplierList" resultMap="supplierMapper">
        select * from supplier where use_flag = 1
    </select>

    <insert id="saveSupplier" parameterType="com.luda.supplier.model.SupplierModel"
            useGeneratedKeys="true" keyProperty="supplierId">
        insert into supplier
        (
            supplier_code,
            supplier_name,
            bank,
            bank_account,
            reg_tax_no,
            contact_person,
            contact_phone,
            use_flag,
            remark
        )
        values
        (
            #{supplierCode},
            #{supplierName},
            #{bank},
            #{bankAccount},
            #{regTaxNo},
            #{contactPerson},
            #{contactPhone},
            #{useFlag},
            #{remark}
        )
    </insert>

    <insert id="saveSupplierContact" parameterType="com.luda.supplier.model.SupplierContactModel"
            useGeneratedKeys="true" keyProperty="contactId">
        insert into supplier_contact
        (
            supplier_id,
            contact_name,
            gender,
            mobile_number,
            tel_number,
            address,
            email,
            post_code,
            head_flag
        )
        values
        (
            #{supplierId},
            #{contactName},
            #{gender},
            #{mobileNumber},
            #{telNumber},
            #{address},
            #{email},
            #{postcode},
            #{headFlag}
        )
    </insert>

    <select id="getMaxSupplierCode" resultType="java.lang.String">
        select max(supplier_code) from supplier
    </select>

    <update id="updateSupplier" parameterType="com.luda.supplier.model.SupplierModel">
        update supplier
        set
            supplier_name = #{supplierName},
            bank = #{bank},
            bank_account = #{bankAccount},
            reg_tax_no = #{regTaxNo},
            contact_person = #{contactPerson},
            contact_phone = #{contactPhone},
            use_flag = #{useFlag},
            remark = #{remark}
        where supplier_id = #{supplierId}
    </update>

    <select id="getSupplierById" resultMap="supplierMapper">
        select * from supplier where supplier_id = #{supplierId} and use_flag = 1
    </select>
</mapper>